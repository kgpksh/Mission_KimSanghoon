# NWeek_OOO.md

## Title: [NWeek] 김멋사

## Title: [1Week] 김상훈

### 미션 요구사항 분석 & 체크리스트

---

#### 1. 필수 미션
- [x] 삭제하려는 호감표시가 DB에 존재하는지 확인하고 없으면 오류 반환
- [x] 자기자신이 추가한 호감표시가 맞는지 확인하고 아니라면 오류 반환
  - [x] 서비스 자체/OAuth 계정 아이디에 연결된 인스타 계정 DB id 가져오기
  - [x] 삭제하려는 호감표시 DB id에 해당하는 등록자 인스타 계정 DB id 가져오기
  - [x] 둘을 비교
- [x] 모든 조건을 통과하면 호감표시 DB에서 해당 행을 삭제한다.
- [x] 컨트롤러에서 삭제 하고 호감표시 목록 화면으로 리다이렉팅 한다.

#### 2. 선택 미션
- [x] 구글에 OAuth를 위한 등록을 함
- [x] application.yml에 구글 OAuth를 이용하기 위한 내용 추가
- [x] login html 파일에 구글 로그인 가능으로 수정

### N주차 미션 요약

---

**[접근 방법]**
#### 1. 필수 미션
- 컨트롤러로 부터 받은 주소에 포함되어 있는 id를 통해 호감표시 DB의 삭제를 시도했으나 잘 되지 않았다.
  알고보니 LikeablePersonService 클래스에 Transactional이 걸려있어 삭제 메서드에는 예외 애노테이션을 추가했다.
- 존재하지 않는 id의 데이터를 삭제하거나 본인이 등록 하지 않은 호감 표시 삭제를 막기 위한 작업을 시작했다.
- Sqlyog를 통해 DB간 연결 구조를 살펴봤다.
- Member 테이블에 연결된 인스타 id 번호와 URL에 포함되어있는 호감표시 ID의 내 ID가 같으면 삭제하기로 했다.
- 존재하지 않는 id 삭제 처리는 쉽게 했다.
- 내것이 아닌 호감표시 삭제를 막는 것에 시간 소모를 했다.
  컨트롤러에서 Principal로 로그인된 회원 username을 받아와서 Member 테이블에서 그 이름을 가진 인스타 계정 id 번호를 찾아 비교하려했으나 항상 본인것이 아닌 것을 삭제하려 한다고 거절되기만 했다.
- 알고보니 착각을 했었다. 컨트롤러에서 받아오는 것은 인스타 회원 username이 아니라 이 서비스 자체/OAuth username이었다.
  그렇기 때문에 Member테이블에서 그 이름을 기준으로 행을 찾은 다음 인스타 id를 다시 찾아야 했다.
- 처음에는 모든 성공뿐만 아니라 실패한 경우에도 RsData에 그에 대한 메세지를 실어 호감표시 리스트로 redirect 시켜줬다.
  그러나 악의적인 접근자가 서버 내부 로직을 브라우저를 통해 알아챌 수도 있다 생각하여 실패의 경우 메세지에 null을 반환시켜 브라우저 상 오류를 발생시키는 것으로 바꿨다.

#### 2. 선택 미션
- 구글 클라우드 서비스에 접속하여 OAuth 사용을 위한 정보를 등록하고 클라이언트 키를 얻는 방법은 구글 검색을 통해 알아냈다.
- application.yml에 추가할 내용을 알아보는 도중 카카오와는 달리 provider 부분은 쓰지 않아도 된다는 것을 알았다.
- 그러나 registration 내용을 작성할 때 카카오와 비슷하게 생각하고 작성하니 실행되지 않았다. 차이점은 다음과 같다
  - 메서드를 post로 할 경우 주소창에 로그인 에러가 난다. 그 부분은 지워도 된다.
  - 클라이언트 아이디와 비밀번호를 모두 작성해야 한다. 에러는 아니지만 로그인 해도 아무것도 일어나지 않는다.
  - scope는 비우지 말고 profile은 반드시 적어 줘야 한다.


**[특이사항]**

기존에 있던 NotProd 클래스의 카카오 자동 로그인 고유코드는 github에 push 하는 것을 감안하여 보안을 위해 별도의 텍스트파일에 기록했다.
텍스트 파일은 gitignore에 등록했다. 한줄에 하나의 고유코드 기록이 있다.
Ut 클래스에 파일을 읽어 카카오외 구글 같은 다른 고유코드들도 프로그램이 실행될 때 한번에 추가, 회원가입 시킬 수 있게 하였다.
application.yml파일도 마찬가지로 git.ignore에 등록했다.

#### 1. 필수 미션
- 서비스 자체/OAuth 계정에 연결된 인스타 계정의 id를 기준으로 본인이 등록한 호감표시가 맞는지 연결하여 확인했다.
  기능은 동작하지만 이것이 최선인지 궁금하다. 엔티티 만들때 설정해 준 OneToOne 애노테이션을 제대로 확용하지 못한 거 아닐까 생각이 든다.

#### 2. 선택 미션
- 라이브러리를 통해 OAuth요청 후 응답이 CustomOAuth2UserService로 들어온다는 것을 이해하는 것과
  MemberService의 whenSocialLogin 메서드를 이해하는데 시간이 걸렸다.
- OAuth를 구현은 했지만 전 과정을 좀 더 공부해야 할 필요를 느꼈다.